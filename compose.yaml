services:
  subtext:
    build:
      context: .
      dockerfile: Dockerfile

    ports:
      - 3000:3000

    develop:
      watch:
        - path: ./package.json
          action: rebuild
        - path: ./next.config.mjs
          action: rebuild
        - path: ./yarn.lock
          action: rebuild
        - path: .
          target: /usr/src/subtext
          action: sync

    environment:
      - DATABASE_URL = ${DATABASE_URL}
      - GOOGLE_CLIENT_SECRET = ${GOOGLE_CLIENT_SECRET}
      - GOOGLE_CLIENT_ID = ${GOOGLE_CLIENT_ID}
      - JWT_SECRET = ${JWT_SECRET}
      - AWS_S3_ACCESS_KEY = ${AWS_S3_ACCESS_KEY}
      - AWS_S3_SECRET_ACCESS_KEY = ${AWS_S3_SECRET_ACCESS_KEY}
      - S3_BUCKET_NAME = ${S3_BUCKET_NAME}

volumes:
  tasked: